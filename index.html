<html>
    <head>
        <title>Freeport Demp</title>
        <script src="https://unpkg.com/algosdk@latest"></script>
        <script src="./buffer.js"></script>
        <script src="./myalgo.js"></script>
       
        <style>
            .algoLoader {
                color: #000000;
                font-size: 20px;
                margin: 100px auto;
                width: 1em;
                height: 1em;
                border-radius: 50%;
                position: relative;
                text-indent: -9999em;
                -webkit-animation: load4 1.3s infinite linear;
                animation: load4 1.3s infinite linear;
                -webkit-transform: translateZ(0);
                -ms-transform: translateZ(0);
                transform: translateZ(0);
}
@-webkit-keyframes load4 {
  0%,
  100% {
    box-shadow: 0 -3em 0 0.2em, 2em -2em 0 0em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 0;
  }
  12.5% {
    box-shadow: 0 -3em 0 0, 2em -2em 0 0.2em, 3em 0 0 0, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;
  }
  25% {
    box-shadow: 0 -3em 0 -0.5em, 2em -2em 0 0, 3em 0 0 0.2em, 2em 2em 0 0, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;
  }
  37.5% {
    box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 0, 2em 2em 0 0.2em, 0 3em 0 0em, -2em 2em 0 -1em, -3em 0em 0 -1em, -2em -2em 0 -1em;
  }
  50% {
    box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 0em, 0 3em 0 0.2em, -2em 2em 0 0, -3em 0em 0 -1em, -2em -2em 0 -1em;
  }
  62.5% {
    box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 0, -2em 2em 0 0.2em, -3em 0 0 0, -2em -2em 0 -1em;
  }
  75% {
    box-shadow: 0em -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0.2em, -2em -2em 0 0;
  }
  87.5% {
    box-shadow: 0em -3em 0 0, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0, -2em -2em 0 0.2em;
  }
}
@keyframes load4 {
  0%,
  100% {
    box-shadow: 0 -3em 0 0.2em, 2em -2em 0 0em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 0;
  }
  12.5% {
    box-shadow: 0 -3em 0 0, 2em -2em 0 0.2em, 3em 0 0 0, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;
  }
  25% {
    box-shadow: 0 -3em 0 -0.5em, 2em -2em 0 0, 3em 0 0 0.2em, 2em 2em 0 0, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;
  }
  37.5% {
    box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 0, 2em 2em 0 0.2em, 0 3em 0 0em, -2em 2em 0 -1em, -3em 0em 0 -1em, -2em -2em 0 -1em;
  }
  50% {
    box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 0em, 0 3em 0 0.2em, -2em 2em 0 0, -3em 0em 0 -1em, -2em -2em 0 -1em;
  }
  62.5% {
    box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 0, -2em 2em 0 0.2em, -3em 0 0 0, -2em -2em 0 -1em;
  }
  75% {
    box-shadow: 0em -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0.2em, -2em -2em 0 0;
  }
  87.5% {
    box-shadow: 0em -3em 0 0, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0, -2em -2em 0 0.2em;
  }
}

            .algoCardContainer{
                border: solid 2px #ccc;
                width: 40%;
                height:400px;
                position: absolute;
                left:30%;
                top:25%;
            }
            .algoInfoText{
                text-align: center;
            }
        </style>
    </head>

    <body>
        <button id="acquireNft">Pay</button>
<!-- 
        <div class="algoCardContainer">
            <div class="algoLoader"></div>
            <p class="algoInfoText">NFT Acquisition in Progress,please respond to Algosiogner Appropriatey</p>
        </div> -->
    </body>

    <script>
    window.addEventListener('load',async function(){

        var style = document.createElement('style');
            style.innerHTML =
                ' .algoLoader {' + 
                'color: #000000;'+
                'font-size: 20px;'+
                'margin: 100px auto;'+
               ' width: 1em;'+
                'height: 1em;'+
                'border-radius: 50%;'+
                'position: relative;'+
               ' text-indent: -9999em;'+
               ' -webkit-animation: load4 1.3s infinite linear;'+
                'animation: load4 1.3s infinite linear;'+
               ' -webkit-transform: translateZ(0);'+
                '-ms-transform: translateZ(0);'+
               ' transform: translateZ(0);'+
'}'+
'@-webkit-keyframes load4 {'+
  '0%,'+
  '100% {'+
    'box-shadow: 0 -3em 0 0.2em, 2em -2em 0 0em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 0;'+'}'+
  '12.5% {'+
    'box-shadow: 0 -3em 0 0, 2em -2em 0 0.2em, 3em 0 0 0, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;'+
'  }'+
  '25% {'+
    'box-shadow: 0 -3em 0 -0.5em, 2em -2em 0 0, 3em 0 0 0.2em, 2em 2em 0 0, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;'
'  }'+
 ' 37.5% {'+
   ' box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 0, 2em 2em 0 0.2em, 0 3em 0 0em, -2em 2em 0 -1em, -3em 0em 0 -1em, -2em -2em 0 -1em;'
  '}'+
 ' 50% {'+
    'box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 0em, 0 3em 0 0.2em, -2em 2em 0 0, -3em 0em 0 -1em, -2em -2em 0 -1em;'+
  '}'+
  '62.5% {'+
    'box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 0, -2em 2em 0 0.2em, -3em 0 0 0, -2em -2em 0 -1em;'
  '}'+
  '75% {'+
    'box-shadow: 0em -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0.2em, -2em -2em 0 0;'+
  '}'+
  '87.5% {'+
  '  box-shadow: 0em -3em 0 0, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0, -2em -2em 0 0.2em;'+
 ' }'+
'}'+
'@keyframes load4 {'+
  '0%,'+
  '100% {'
   ' box-shadow: 0 -3em 0 0.2em, 2em -2em 0 0em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 0;'+
  '}'+
  '12.5% {'+
    'box-shadow: 0 -3em 0 0, 2em -2em 0 0.2em, 3em 0 0 0, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;'+
  '}'+
  '25% {'+
    'box-shadow: 0 -3em 0 -0.5em, 2em -2em 0 0, 3em 0 0 0.2em, 2em 2em 0 0, 0 3em 0 -1em, -2em 2em 0 -1em, -3em 0 0 -1em, -2em -2em 0 -1em;'+
  '}'+
  '37.5% {'+
    'box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 0, 2em 2em 0 0.2em, 0 3em 0 0em, -2em 2em 0 -1em, -3em 0em 0 -1em, -2em -2em 0 -1em;'+
  '}'
  '50% {'+
 '   box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 0em, 0 3em 0 0.2em, -2em 2em 0 0, -3em 0em 0 -1em, -2em -2em 0 -1em;'+
 ' }'+
 ' 62.5% {'+
    'box-shadow: 0 -3em 0 -1em, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 0, -2em 2em 0 0.2em, -3em 0 0 0, -2em -2em 0 -1em;'+
 ' }'+
  '75% {'+
   ' box-shadow: 0em -3em 0 -1em, 2em -2em 0 -1em, 3em 0em 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0.2em, -2em -2em 0 0;'+
  '}'+
 ' 87.5% {'+
   ' box-shadow: 0em -3em 0 0, 2em -2em 0 -1em, 3em 0 0 -1em, 2em 2em 0 -1em, 0 3em 0 -1em, -2em 2em 0 0, -3em 0em 0 0, -2em -2em 0 0.2em;'+
 ' }};'

 var ref = document.querySelector('script');
 ref.parentNode.insertBefore(style, ref);

    var recoveredAccount1 = algosdk.mnemonicToSecretKey("portion never forward pill lunch organ biology" +
    " weird catch curve isolate plug innocent skin grunt" +
    " bounce clown mercy hole eagle soul chunk type absorb trim");
    var recoveredAccount2={addr:""}
    var asssetCreatorAddress = "AGP3QJRPRIX52M6HCPWYZ266QQRMD3JPBIS5NWJE7GSERAWBX4DFGYQIO4"
    var artist1Address= "YGCKHAG4H3WDUQSAY5J4MK5ZIWLGIF7W6ZYO5EZY3OGZJB5FWGDNBX7BUA";
    var artist2Address = "IKEPBSW7RSPN4TXYC3AV6FOOGZ6PJLTJKEB2PVCTPSRFNB3CANZ5JJRZPY";
    var artist3Address= "2FSBHE3XAXJHBFFUABPPBBU3ZL4PQAHI6BB3KTHJKL5IZCC7BG4LR6GRT4";
    var artist4Address = "UONII5HLZPHGDCBCETVTFGX42I5MJWEYKM5NUIFQW3A47CSDIHZN74AYUA";
    var artist5Address = "EMMEIOWLZPMUCXSLGB5QOR33HCQZAQT6KSRGCXHBO54W7LNLQCJXSGJ4IQ";
    var artist6Address = "UNH443RNFL4NWFCP5AI3N34C6IK6SWDEPZRLFKXGWYTXBZ5BTLJJLGWLRQ";
    var artist7Address = "QPNWTRS3FLRUICYYLVPQV7QZIJPBNM2EV6S5BF6JOFQL7DGCLU5HKQSUK4";
    var epochClawedBackAddress = "2ZORRJ2BOE7W2WPOXWEFGCKHVYCVM3OVYGCL5I755VLREAFJ3JGVH3C2XM"
    var epochBase64Address = "AyADkE4GyN/9BzMAIDIDEjMBIDIDEhAzAiAyAxIQMwAJMgMSEDMBCTIDEhAzAgkyAxIQMwAVMgMSEDMBFTIDEhAzAhUyAxIQMQEiDhAzAhAjEhAzAhgkEhA=";
    var actualAssetPrice = 1000000
    var artistAmount = ((10/100)*actualAssetPrice);
    var creatorAmount = ((30/100)*actualAssetPrice);
    const token = { 'X-API-Key':'ADRySlL0NK5trzqZGAE3q1xxIqlQdSfk1nbHxTNe'};
    const server = "https://testnet-algorand.api.purestake.io/ps2";
    const port = '';
    const client = new algosdk.Algodv2(token, server, port);
    let Buffer = buffer.Buffer
    let program = new Uint8Array(Buffer.from(epochBase64Address,"base64"))
    const lsig = algosdk.makeLogicSig(program);   
    let note = new Uint8Array(Buffer.from("","base64"));
    var addresses = []
    var addressToUse;
    let  params={};
    let allAssets = [16740295,16740297,16740298,16740299,16740300];
    let assetNames = ["Epoch 1/5", "Epoch 2/5","Epoch 3/5","Epoch 4/5","Epoch 5/5"];
    let assetName = "";
    let assetId = -1;
    let globalAppId = 16740296;
    let button = document.getElementById("acquireNft");

    // console.log(myAlgoConnect)
    // console.log(myalgo);
    var myalgoConnect = new MyAlgoConnect();
    const printCreatedApp = async function (algodclient, account, assetid) {
    // note: if you have an indexer instance available it is easier to just use this
    //     let accountInfo = await indexerClient.searchAccounts()
    //    .assetID(assetIndex).do();
    // and in the loop below use this to extract the asset for a particular account
    // accountInfo['accounts'][idx][account]);
    let accountInfo = {}
    try{
      accountInfo =  await algodclient.accountInformation(account).do();
    }catch(error){
      console.error(error);
      alert(error)
      body.removeChild(parentDiv);
    }
   
    console.log(accountInfo);
    let retVal = "";
    for (idx = 0; idx < accountInfo['created-apps'].length; idx++) {
        let scrutinizedAsset = accountInfo['created-apps'][idx];
        if (scrutinizedAsset['id'] == assetid) {
            let myparms = JSON.stringify(scrutinizedAsset['params'], undefined, 2);
            scrutinizedAsset.params["global-state"].map((el)=>{
              let key = atob(el.key);
              if(key=="edition"){
                retVal= el.value.uint
              }
            })
            break;
        }
    }
    return retVal;
};


const printCreatedAsset = async function (algodclient, account, assetid) {
    let accountInfo = await algodclient.accountInformation(account).do();
    for (idx = 0; idx < accountInfo['created-assets'].length; idx++) {
        let scrutinizedAsset = accountInfo['created-assets'][idx];
        if (scrutinizedAsset['index'] == assetid) {
            console.log("AssetID = " + scrutinizedAsset['index']);
            let myparms = JSON.stringify(scrutinizedAsset['params'], undefined, 2);
            console.log("parms = " + myparms);
            break;
        }
    }
};

const printAssetHolding = async function (algodclient, account, assetid) {
    // note: if you have an indexer instance available it is easier to just use this
    //     let accountInfo = await indexerClient.searchAccounts()
    //    .assetID(assetIndex).do();
    // and in the loop below use this to extract the asset for a particular account
    // accountInfo['accounts'][idx][account]);
    return new Promise(async(resolve,reject)=>{

      try{
        let accountInfo = await algodclient.accountInformation(account).do();
    for (idx = 0; idx < accountInfo['assets'].length; idx++) {
        let scrutinizedAsset = accountInfo['assets'][idx];
        if (scrutinizedAsset['asset-id'] == assetid) {
            let myassetholding = JSON.stringify(scrutinizedAsset, undefined, 2);

            console.log("assetholdinginfo = " + myassetholding);
            resolve(JSON.parse(myassetholding));
            break;
        }
    }
      }catch(error){
        reject(error);
        console.error(error);
        body.removeChild(parentDiv);
      }

    
    })
  
};
       
    button.addEventListener("click",async function(){
        console.log("Clicked");
        var x = document.getElementsByTagName("body");
        console.log(x);
        console.log(x[0]);
        let body = x[0];
        let parentDiv = document.createElement("div");
        parentDiv.style.border="solid 2px #ccc";

        parentDiv.style.left="25%";
        parentDiv.style.top="30%";
        parentDiv.style.position="absolute";
       parentDiv.style.elevation="100";
        parentDiv.style.width="40%";
        parentDiv.style.height="400px";
       parentDiv.style.background="#fff";
        parentDiv.classList.add("algoCardContainer");
        let algoLoaderDiv = document.createElement("div");
        algoLoaderDiv.classList.add("algoLoader");

        let infoP= document.createElement("P");
        infoP.style.textAlign="center"
        infoP.classList.add("algoInfoText");
        infoP.innerText="NFT Acquisition in Progress";
        parentDiv.append(algoLoaderDiv);
        parentDiv.append(infoP);
        body.append(parentDiv)


      
        let assetHolding ={} 
        try{ 
          assetHolding =  await printAssetHolding(client,asssetCreatorAddress,allAssets[0]);
          if(assetHolding["amount"]==1){
              assetId = allAssets[0]
              assetName = assetNames[0];
          }else{
            assetHolding =  await printAssetHolding(client,asssetCreatorAddress,allAssets[1]);
            if(assetHolding["amount"]==1){
              assetId = allAssets[1]
              assetName = assetNames[1]
            }else{
              assetHolding =  await printAssetHolding(client,asssetCreatorAddress,allAssets[2]);
              if(assetHolding["amount"]==1){
              assetId = allAssets[2]
              assetName = assetNames[2]
            }else{
              assetHolding =  await printAssetHolding(client,asssetCreatorAddress,allAssets[3]);
              if(assetHolding["amount"]==1){
              assetId = allAssets[3]
              assetName = assetNames[3];
            }else{
              assetHolding =  await printAssetHolding(client,asssetCreatorAddress,allAssets[4]);
              if(assetHolding["amount"]==1){
              assetId = allAssets[4];
              assetName = assetNames[4]
            }else{
              assetId=-1;
            }
            }
            }
            }
         

          }
          console.log(assetHolding);
        }catch(error){
          alert(error);
          return;
        }

      

      if(assetId==-1){
        alert("All 5 editions have been sold already");
        body.removeChild(parentDiv);
        return;
      }else{
        infoP.innerText=`Edition ${assetName} NFT acquisition in progress`;
      }

      myalgoConnect.connect().then(async(addresses)=>{
        if(addresses.length>1){
      addressToUse = prompt("Enter My Algo wallet desired Address");
      }else{
        addressToUse = addresses[0].address
      }


      try{
          let account_info = (await client.accountInformation(addressToUse).do());
          if(account_info.amount<2000000){
            console.log(account_info);
          alert("You do not have enough funds to purchase NFT");
          return;
          };
         
        } catch(error){
          console.error(error);
          alert(error);
          body.removeChild(parentDiv);
          return;
        } 

  
    recoveredAccount2.addr=addressToUse;
    var addressFound = 0;
    console.log(addresses)
    addresses.map((el)=>{
        if(el.address==addressToUse){
            addressFound = 1;
        }

    });

    if(addressFound == 0){
        alert("Cant find address, refresh to continue")  
     body.removeChild(parentDiv);
        return;   
    }
        
     
              console.log(recoveredAccount2.addr)

              try {
                params = await client.getTransactionParams().do();
                }
                catch(error) {
                  console.error("Error ocurred ", error);
                    alert(error)
                    body.removeChild(parentDiv);
                    return;
                }
             
            
            let optInTxn =  optInAddress(assetId,recoveredAccount2.addr);
            myalgoConnect.signTransaction(optInTxn).then(async(signedOptTxn)=>{
            console.log(signedOptTxn);
            infoP.innerText="Opting Users Address to NFT"
            let optSentTx={}
            try{
              optSentTx=await client.sendRawTransaction(signedOptTxn.blob).do();
              }catch(error){
                console.error("Error ocurred ", error);
                    alert(error)
                    body.removeChild(parentDiv);
                    return;
              }
            console.log("sent opt in transaction with txId: "+ optSentTx.txId);

            infoP.innerText="User's Wallet Address Opted In to NFT"
            //transaction 1 to send asset
            var assetSendTxn =   sendAsset(assetId,asssetCreatorAddress,recoveredAccount2.addr,1,client);
            // transaction 2 to send  30% of the asset
            var epochTrans =  sendFunds(recoveredAccount2,asssetCreatorAddress,creatorAmount,client)
            //transaction 3 to make the application call
            var appCallTxn =  makeApplicationCallTransaction(recoveredAccount2.addr,globalAppId,[])
            // transaction 4 to 10 to send the funds to the remaining ten addresses
            var royaltyTransaction1 =  sendFunds(recoveredAccount2,artist1Address,artistAmount);
            var royaltyTransaction2 =  sendFunds(recoveredAccount2,artist2Address,artistAmount);
            var royaltyTransaction3 =  sendFunds(recoveredAccount2,artist3Address,artistAmount);
            var royaltyTransaction4 =  sendFunds(recoveredAccount2,artist4Address,artistAmount);
            var royaltyTransaction5 =  sendFunds(recoveredAccount2,artist5Address,artistAmount);
            var royaltyTransaction6 =  sendFunds(recoveredAccount2,artist6Address,artistAmount);
            var royaltyTransaction7 =  sendFunds(recoveredAccount2,artist7Address,artistAmount);
            let txns = [assetSendTxn,epochTrans,appCallTxn,royaltyTransaction1,royaltyTransaction2,royaltyTransaction3,royaltyTransaction4,royaltyTransaction5,royaltyTransaction6,royaltyTransaction7]
            let groupId = algosdk.computeGroupID(txns);
            txns = txns.map((el)=>{
            el.group=groupId;
            return el;
            });
          let signedTxn0 = algosdk.signLogicSigTransaction(txns[0], lsig)



          myalgoConnect.signTransaction([txns[1], txns[2], txns[3],txns[4],txns[5],txns[6],txns[7],txns[8],txns[9]]).then(async(signedTxns)=>{
            console.log(signedTxns)
              let blobs = signedTxns.map((el,index)=>{
                  return el.blob
              })
          let signedTest = [signedTxn0.blob,...blobs];
          console.log(signedTest)
          let txTest={};
          try{
            txTest=(await client.sendRawTransaction(signedTest).do());
          }catch(error){
            console.error("Error ocurred ", error);
                    alert(error)
                    body.removeChild(parentDiv);
                    return;
            }
          console.log("Transaction : " + txTest.txId);
          if(txTest.txId!=null&&txTest.txId!=undefined){
              infoP.innerText="Transaction successfull with Txid: "+ txTest.txId;
            alert("Transaction successfull with Txid: "+ txTest.txId );
            body.removeChild(parentDiv);
          }else{
              alert("Transaction Failed");
              body.removeChild(parentDiv);
          } 
          }).catch((error)=>{
            console.error("Error ocurred ", error);
                alert(error)
                body.removeChild(parentDiv);
          });
      

            }).catch((error)=>{
              console.error("Error ocurred ", error);
                alert(error)
                body.removeChild(parentDiv);
            }); 
           
              }).catch((error)=>{
                console.error("Error ocurred ", error);
                alert(error)
                body.removeChild(parentDiv);
              })

          
 




  

})


     function sendAsset(assetID,revocationTarget,recipient, units,algodClient){   
       
        closeRemainderTo = undefined;
        //Amount of the asset to transfer
        amount = units;

        // signing and sending "txn" will send "amount" assets from "sender" to "recipient"
        let xtxn = algosdk.makeAssetTransferTxnWithSuggestedParams(epochClawedBackAddress, recipient, closeRemainderTo, revocationTarget,
                amount,  new Uint8Array(Buffer.from("FREEPORT” – featuring Neïl Beloufa, Sarah Rosalena Brady, Alice Bucknell, Juan Covelli, Alexandra Koumantaki, Amanda Ross-Ho, Hirad Sab")), assetID, params);
        let program = new Uint8Array(Buffer.from(epochBase64Address,"base64"))
        const lsig = algosdk.makeLogicSig(program);   
       console.log(lsig.address());
        // let rawSignedTxn = algosdk.signLogicSigTransactionObject(xtxn, lsig)
        return xtxn;
    }

     function sendFunds(sender,receiver,amount){
      let    txn = {
            ...params,
            fee: 1000,
            flatFee: true,
            type: 'pay',
            from: sender.addr,
            to:  receiver,
            amount: amount,
            note: new Uint8Array(Buffer.from('Hello World'))
    };
     
        return txn;
    }

     function makeApplicationCallTransaction(sender,appId,appArgs){
        let txn = {
            type: "appl",
            appOnComplete: 0,
            from: sender,
            appIndex: appId,
            fee: 1000,
            flatFee: true,
            ...params
  };
        return txn;
    }

     function optInAddress(assetID,address){
     
        let sender = address;
        let recipient = sender;
        
        let revocationTarget = undefined;
       
        let closeRemainderTo = undefined;
      
        amount = 0;


      
        let opttxn = {
          ...params,
          fee: 1000,
          flatFee: true,
          type: 'axfer',
          assetIndex: assetID,
          from: sender,
          to:  recipient,
          amount: 0,
          note: new Uint8Array(Buffer.from('Hello World'))
        };
        console.log(opttxn);
            return opttxn;

    }
});

  
    </script>
</html>